"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var caribviper_common_1=require("caribviper-common"),PouchDB=require("pouchdb"),PouchDbFind=require("pouchdb-find"),DatabaseServerConnection=function(){function e(e,t,i,s,r,n){void 0===r&&(r=!1),void 0===n&&(n=1e4),this.server=e,this.databaseName=t,this.user=i,this.password=s,this.secure=r,this.timeout=n}return e.createNewConnection=function(t,i){return new e(t.server,i,t.user,t.password,t.secure,t.timeout)},e}();exports.DatabaseServerConnection=DatabaseServerConnection;var DatabaseObject=function(){function e(e){this.initialized=!1,this.status="",PouchDB.plugin(PouchDbFind),e&&("string"==typeof e?this.connect(e):this.connect(e.server,e.databaseName,e.user,e.password,e.secure))}return Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.initialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"database",{get:function(){return this.initialized?this._db:void 0},enumerable:!0,configurable:!0}),e.prototype.connect=function(e,t,i,s,r,n){void 0===t&&(t=""),void 0===i&&(i=""),void 0===s&&(s=""),void 0===r&&(r=!1),void 0===n&&(n=1e4);var o=e,a=t;if(this.status=this.status+"creating connectionn\n",caribviper_common_1.Assert.isTrue(!!i&&!!s||!i&&!s,"Both the username and password must be specified to user user/password credentials"),this.status=this.status+"passed user|password\n",i){a&&((a=a.replace("///g",""))&&(a="/"+a),a=a.toLowerCase());var c=e.replace("http://","").replace("https://","");o="http"+(r?"s":"")+"://"+i+":"+s+"@"+c+a,this.status=this.status+"connection "+o+"\n"}this._db=new PouchDB(o,{ajax:{cache:!1,timeout:!n||n<1e3||n>1e4?1e4:n}}),this.initialized=!0},e.prototype.close=function(){if(this._db)return this._db.close()},e.prototype.info=function(){return this.database.info().then(function(e){return e}).catch(function(e){return Promise.reject(e)})},e}();exports.DatabaseObject=DatabaseObject;